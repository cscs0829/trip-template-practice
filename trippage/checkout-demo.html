<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>주문서 (데모) - 트립페이지</title>
	<link rel="icon" type="image/png" href="img/icon/bavel.png">

	<!-- Meta Description -->
	<meta name="description" content="트립페이지 - 여행 상품 판매 및 여행 정보 제공">
	<meta name="keywords" content="여행, 여행상품, 여행사, 여행정보, 여행가이드">
	<meta name="robots" content="index, nofollow">
	<meta name="web_author" content="트립페이지">
	<meta name="language" content="Korean">  

	<!-- Import Icon -->
  	<link rel="stylesheet" type="text/css" href="css/ionicons.min.css">

	<!-- Import Style -->
	<link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="css/swiper.css">
    <link rel="stylesheet" type="text/css" href="css/checkout.css">
    
    <!-- Toss Payments SDK -->
    <script src="https://js.tosspayments.com/v2/standard"></script>
</head>
<body style="background: #e6eaed;">

<!-- Reusable Navbar -->
<script type="text/javascript" src="js/navbar.js"></script>
<script>renderNavbar('checkout-demo');</script>

<!-- Sidebar -->
<div class="sidebar">
<ul class="sidebar-list">
	<li><a href="" class="close"><span class="ion-android-close"></span></a></li>
	<li class="sidebar-list-hover"><a href="index.html">홈</a></li>
    <li class="sidebar-list-hover"><a href="destination.html">여행지</a></li>
    <li class="sidebar-list-hover"><a href="gallery.html">갤러리</a></li>
    <li class="sidebar-list-hover"><a href="index.html#discover">상품소개</a></li>
    <li class="sidebar-list-hover"><a href="board.html">게시판</a></li>
    <li><a class="btn btn-orange btn-round" href="login.html">로그인</a></li>
</ul>                    
</div>

<!-- Sidebar Overlay -->
<section class="sidebar-overlay"></section>

<!-- Login Form -->
<div class="login-form">
	<div class="login-top">
		<span class="close">&times;</span>
	</div>
	<div class="login">
		<h3 class="text-center">
			트립페이지 로그인
		</h3>
		<div class="form-input">
			<label>이메일</label> <br>
			<input type="email" name="" class="form-control">
		</div>
		<div class="form-input">
			<label>비밀번호</label> <br>
			<input type="password" name="" class="form-control">
		</div>
		<div class="form-input">
			<button type="submit" class="btn btn-login">로그인</button>
		</div>
		<a href="" class="text-center">계정이 없으신가요? 회원가입하기</a>
	</div>
</div>

<div class="login-overlay"></div>

<!-- Section -->
<section class="section-ticket">
    <div class="checkout-container">
        <div class="demo-notice">
            <h4>🚧 데모 페이지 안내</h4>
            <p>이 페이지는 토스페이먼츠 결제위젯 연동 데모입니다.<br>
            실제 결제가 이루어지지 않으며, 실제 서비스에서는 본인의 API 키를 사용해야 합니다.</p>
        </div>
        
        <div class="checkout-header">
            <h2>주문서 (데모)</h2>
        </div>
    
    <!-- Order Summary -->
    <div class="order-summary">
        <h3>주문 상품</h3>
        <div class="order-item">
            <img src="img/elephant.jpg" alt="코끼리 사파리 공원">
            <div class="order-details">
                <h4 id="productName">코끼리 사파리 공원</h4>
                <p id="travelDate">여행 날짜: 2025-01-15</p>
                <p id="paxCount">인원 수: 2명</p>
                <p>시간: 08:00 - 16:00</p>
                <p>포함사항: 교통편, 아침식사, 입장료, 보험</p>
            </div>
        </div>
        
        <div class="price-summary">
            <div class="price-row">
                <span>상품 가격</span>
                <span id="basePrice">₩ 120,000</span>
            </div>
            <div class="price-row">
                <span>인원 수</span>
                <span id="paxDisplay">2명</span>
            </div>
            <div class="price-row total">
                <span>총 결제 금액</span>
                <span id="totalPrice">₩ 240,000</span>
            </div>
        </div>
    </div>
    
    <!-- Payment Button Section -->
    <div class="payment-section">
        <div class="loading" id="paymentLoading">
            <div class="loading-spinner"></div>
            <p>결제 처리 중입니다...</p>
        </div>
        <button type="button" class="payment-button" id="paymentButton">
            결제하기 (데모)
        </button>
    </div>
    </div>
</section>

<!-- 결제 모달 -->
<div id="paymentModal" class="payment-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">결제 수단 선택</h3>
            <button class="modal-close" id="modalClose">&times;</button>
        </div>
        <div class="modal-body">
            <div class="payment-method-item selected" data-method="card">
                <div class="payment-method-info">
                    <div class="payment-method-icon">💳</div>
                    <div class="payment-method-text">
                        <h4>카드</h4>
                        <p>신용카드, 체크카드</p>
                    </div>
                </div>
                <div class="payment-method-radio"></div>
            </div>
            
            <div class="payment-method-item" data-method="transfer">
                <div class="payment-method-info">
                    <div class="payment-method-icon">🏦</div>
                    <div class="payment-method-text">
                        <h4>계좌이체</h4>
                        <p>실시간 계좌이체</p>
                    </div>
                </div>
                <div class="payment-method-radio"></div>
            </div>
            
            <div class="payment-method-item" data-method="phone">
                <div class="payment-method-info">
                    <div class="payment-method-icon">📱</div>
                    <div class="payment-method-text">
                        <h4>휴대폰</h4>
                        <p>휴대폰 소액결제</p>
                    </div>
                </div>
                <div class="payment-method-radio"></div>
            </div>
            
            <div class="payment-method-item" data-method="kakaopay">
                <div class="payment-method-info">
                    <div class="payment-method-icon">💛</div>
                    <div class="payment-method-text">
                        <h4>카카오페이</h4>
                        <p>간편결제</p>
                    </div>
                </div>
                <div class="payment-method-radio"></div>
            </div>
            
            <div class="payment-method-item" data-method="naverpay">
                <div class="payment-method-info">
                    <div class="payment-method-icon">💚</div>
                    <div class="payment-method-text">
                        <h4>네이버페이</h4>
                        <p>간편결제</p>
                    </div>
                </div>
                <div class="payment-method-radio"></div>
            </div>
            
            <div class="payment-method-item" data-method="tosspay">
                <div class="payment-method-info">
                    <div class="payment-method-icon">🔵</div>
                    <div class="payment-method-text">
                        <h4>토스페이</h4>
                        <p>간편결제</p>
                    </div>
                </div>
                <div class="payment-method-radio"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="modal-pay-button" id="modalPayButton">
                <span id="selectedMethodName">카드</span>로 ₩ <span id="modalAmount">240,000</span> 결제하기
            </button>
        </div>
    </div>
</div>

<!-- Footer (reusable) -->
<script type="text/javascript" src="js/footer.js"></script>
<script>renderFooter();</script>

    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <script type="text/javascript" src="js/jquery.swipebox.min.js"></script>
    
    <script>
        // 고정된 데모 데이터
        const totalAmount = 240000;
        
        // 토스페이먼츠 공식 테스트 클라이언트 키 (토스페이먼츠 공식 문서에서 제공)
        const clientKey = 'test_ck_DnyRpQWGrNzjqXtj8k2rKWzZzlNLxRnkqAOxJVdNhZmY2cEoZmKLvgD4JZnk';
        
        // 결제위젯 초기화
        let paymentWidget;
        let tossPayments;
        
        // DOM이 로드된 후 초기화
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('DOM 로드 완료, 결제 시스템 초기화');
            
            // 모달 금액 표시 업데이트
            document.getElementById('modalAmount').textContent = totalAmount.toLocaleString();
            
            // 모달 이벤트 리스너 추가
            initializeModal();
            
            // 실제 토스페이먼츠 연동 시도 (옵션)
            try {
                if (typeof TossPayments !== 'undefined') {
                    tossPayments = TossPayments(clientKey);
                    paymentWidget = tossPayments.widgets({
                        customerKey: generateRandomString(),
                    });
                    
                    await paymentWidget.setAmount({
                        currency: 'KRW',
                        value: totalAmount,
                    });
                    
                    console.log('실제 결제위젯도 준비되었습니다.');
                }
            } catch (error) {
                console.log('실제 결제위젯은 사용할 수 없습니다. 시뮬레이션 모드로 작동합니다.');
            }
            
            console.log('결제 시스템이 준비되었습니다.');
        });
        
        // 모달 초기화 함수
        function initializeModal() {
            const modal = document.getElementById('paymentModal');
            const modalClose = document.getElementById('modalClose');
            const paymentMethodItems = document.querySelectorAll('.payment-method-item');
            const selectedMethodName = document.getElementById('selectedMethodName');
            const modalPayButton = document.getElementById('modalPayButton');
            
            // 결제 수단 선택 이벤트
            paymentMethodItems.forEach(item => {
                item.addEventListener('click', function() {
                    // 모든 항목에서 selected 클래스 제거
                    paymentMethodItems.forEach(i => i.classList.remove('selected'));
                    
                    // 선택된 항목에 selected 클래스 추가
                    this.classList.add('selected');
                    
                    // 선택된 결제 수단 업데이트
                    selectedPaymentMethod = this.dataset.method;
                    const methodName = this.querySelector('h4').textContent;
                    selectedMethodName.textContent = methodName;
                    
                    console.log('선택된 결제수단:', selectedPaymentMethod, methodName);
                });
            });
            
            // 모달 닫기 이벤트
            modalClose.addEventListener('click', closeModal);
            
            // 모달 배경 클릭 시 닫기
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal();
                }
            });
            
            // ESC 키로 모달 닫기
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal.classList.contains('show')) {
                    closeModal();
                }
            });
            
            // 모달 내 결제하기 버튼
            modalPayButton.addEventListener('click', function() {
                closeModal();
                processPayment();
            });
        }
        
        // 모달 열기 함수
        function openModal() {
            const modal = document.getElementById('paymentModal');
            modal.classList.add('show');
            document.body.style.overflow = 'hidden'; // 스크롤 방지
        }
        
        // 모달 닫기 함수
        function closeModal() {
            const modal = document.getElementById('paymentModal');
            modal.classList.remove('show');
            document.body.style.overflow = ''; // 스크롤 복원
        }
        
        // 랜덤 문자열 생성 함수
        function generateRandomString() {
            return Math.random().toString(36).substring(2, 15);
        }
        
        // 주문 ID 생성 함수
        function generateOrderId() {
            const date = new Date();
            const dateString = date.getFullYear().toString() + 
                             (date.getMonth() + 1).toString().padStart(2, '0') + 
                             date.getDate().toString().padStart(2, '0');
            const timeString = date.getHours().toString().padStart(2, '0') + 
                             date.getMinutes().toString().padStart(2, '0') + 
                             date.getSeconds().toString().padStart(2, '0');
            const randomString = Math.random().toString(36).substring(2, 8);
            return `DEMO_${dateString}_${timeString}_${randomString}`;
        }
        
        // 선택된 결제 수단
        let selectedPaymentMethod = 'card';
        
        // 결제하기 버튼 클릭 이벤트 (모달 열기)
        document.getElementById('paymentButton').addEventListener('click', function() {
            console.log('결제하기 버튼 클릭 - 모달 열기');
            openModal();
        });
        
        // 결제 수단별 이름 매핑
        const paymentMethodNames = {
            'card': '카드',
            'transfer': '계좌이체',
            'phone': '휴대폰',
            'kakaopay': '카카오페이',
            'naverpay': '네이버페이',
            'tosspay': '토스페이'
        };
        
        // 실제 결제 처리 함수
        async function processPayment() {
            // 로딩 표시
            document.getElementById('paymentLoading').style.display = 'block';
            document.getElementById('paymentButton').disabled = true;
            
            try {
                const orderId = generateOrderId();
                console.log('결제 요청 시작, 주문ID:', orderId);
                console.log('선택된 결제수단:', selectedPaymentMethod);
                
                // 실제 결제위젯이 있는 경우
                if (paymentWidget) {
                    await paymentWidget.requestPayment({
                        orderId: orderId,
                        orderName: '코끼리 사파리 공원 (데모)',
                        customerName: '홍길동',
                        customerEmail: 'demo@trippage.co.kr',
                        customerMobilePhone: '01012345678',
                        successUrl: `${window.location.origin}/trippage/my-reservation.html?orderId=${orderId}&orderName=${encodeURIComponent('코끼리 사파리 공원 (데모)')}&method=${encodeURIComponent(paymentMethodNames[selectedPaymentMethod] || '카드')}&amount=${totalAmount}&paymentKey=test_payment_key_${Date.now()}`,
                        failUrl: `${window.location.origin}/trippage/fail.html`,
                    });
                } else {
                    // 시뮬레이션 모드
                    console.log('시뮬레이션 결제 진행 중...');
                    
                    // 2초 후 예약 페이지로 이동 (시뮬레이션)
                    setTimeout(() => {
                        const reservationUrl = `my-reservation.html?orderId=${orderId}&orderName=${encodeURIComponent('코끼리 사파리 공원 (데모)')}&method=${encodeURIComponent(paymentMethodNames[selectedPaymentMethod])}&amount=${totalAmount}&paymentKey=test_payment_key_${Date.now()}`;
                        window.location.href = reservationUrl;
                    }, 2000);
                }
                
            } catch (error) {
                console.error('결제 오류:', error);
                showErrorToast(`결제 중 오류가 발생했습니다: ${error.message || '알 수 없는 오류'}`);
                
                // 로딩 숨기기
                document.getElementById('paymentLoading').style.display = 'none';
                document.getElementById('paymentButton').disabled = false;
            }
        }
        
        // 스크롤 이벤트로 navbar 스타일 변경
        window.addEventListener('scroll', function() {
            const navbar = document.querySelector('.navbar');
            const scrollPosition = window.scrollY;
            
            if (scrollPosition > 50) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });
        
        // 사이드바 디버깅
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM 로드 완료');
            
            // jQuery 확인
            if (typeof $ !== 'undefined') {
                console.log('jQuery 로드됨');
                
                // 사이드바 토글 버튼 확인
                const sidebarToggle = $('.sidebar-toggle');
                console.log('사이드바 토글 버튼:', sidebarToggle.length);
                
                // 수동으로 이벤트 추가 (백업)
                $('.sidebar-toggle').off('click').on('click', function(e) {
                    console.log('사이드바 토글 클릭됨');
                    e.preventDefault();
                    $('.sidebar').addClass('active');
                    $('.sidebar-overlay').css('visibility', 'visible');
                });
                
                $('.sidebar-overlay, .close').off('click').on('click', function(e) {
                    console.log('사이드바 닫기 클릭됨');
                    e.preventDefault();
                    $('.sidebar').removeClass('active');
                    $('.sidebar-overlay').css('visibility', 'hidden');
                });
            } else {
                console.error('jQuery가 로드되지 않았습니다');
            }
        });
    </script>
</body>
</html>
