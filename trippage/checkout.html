<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>주문서 - 트립페이지</title>
	<link rel="icon" type="image/png" href="img/icon/bavel.png">

	<!-- Meta Description -->
	<meta name="description" content="트립페이지 - 해외패키지여행 전문 여행사">
	<meta name="keywords" content="해외여행, 패키지여행, 발리, 관광">
	<meta name="robots" content="index, nofollow">
	<meta name="web_author" content="트립페이지">
	<meta name="language" content="Korean">  

	<!-- Import Icon -->
  	<link rel="stylesheet" type="text/css" href="css/ionicons.min.css">

	<!-- Import Style -->
	<link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="css/swiper.css">
    
    <!-- Toss Payments SDK -->
    <script src="https://js.tosspayments.com/v2/standard"></script>
</head>
<body style="background: #e6eaed;">



<!-- Navbar -->
<nav class="navbar">
	<div class="container">
		<div class="navbar-bars">
			<a href="#" class="navbar-title sidebar-toggle" style="padding: 0;"><i class="ion-navicon-round"></i></a>
        	<a href="index.html" class="navbar-title">트립페이지</a>
		</div>
		<div class="navbar-item">
			<a href="index.html" class="navbar-title">트립페이지</a>
			<ul>
		        <li><a href="destination.html">여행지</a></li>
			    <li><a href="gallery.html">갤러리</a></li>
			    <li><a data-slide="slides" data-slide-target="#discover">상품소개</a></li>
			    <li><a href="news.html">뉴스</a></li>
				<li><button class="btn-login" id="openLogin">로그인</button></li>
  		  	</ul>
		</div>
	</div>
</nav>

<!-- Sidebar -->
<div class="sidebar">
<ul class="sidebar-list">
	<li><a href="" class="close"><span class="ion-android-close"></span></a></li>
	<li class="sidebar-list-hover"><a href="index.html">홈</a></li>
    <li class="sidebar-list-hover"><a href="destination.html">해외여행지</a></li>
    <li class="sidebar-list-hover"><a href="gallery.html">갤러리</a></li>
    <li class="sidebar-list-hover"><a href="index.html#discover">상품소개</a></li>
    <li class="sidebar-list-hover"><a href="news.html">뉴스</a></li>
    <li><a class="btn btn-orange btn-round" href="login.html">로그인</a></li>
</ul>                    
</div>

<!-- Sidebar Overlay -->
<section class="sidebar-overlay"></section>

<!-- Login Form -->
<div class="login-form">
	<div class="login-top">
		<span class="close">&times;</span>
	</div>
	<div class="login">
		<h3 class="text-center">
			트립페이지 로그인
		</h3>
		<div class="form-input">
			<label>이메일</label> <br>
			<input type="email" name="" class="form-control">
		</div>
		<div class="form-input">
			<label>비밀번호</label> <br>
			<input type="password" name="" class="form-control">
		</div>
		<div class="form-input">
			<button type="submit" class="btn btn-login">로그인</button>
		</div>
		<a href="" class="text-center">계정이 없으신가요? 지금 가입하세요</a>
	</div>
</div>

<div class="login-overlay"></div>

<!-- Checkout Container -->
<div class="checkout-container">
    <div class="checkout-header">
        <h2>주문서</h2>
    </div>
    
    <!-- Order Summary -->
    <div class="order-summary">
        <h3>주문 상품</h3>
        <div class="order-item">
            <img src="img/elephant.jpg" alt="코끼리 사파리 공원">
            <div class="order-details">
                <h4 id="productName">코끼리 사파리 공원</h4>
                <p id="travelDate">여행 날짜: -</p>
                <p id="paxCount">인원 수: -</p>
                <p>시간: 08:00 - 16:00</p>
                <p>포함사항: 교통편, 아침식사, 입장료, 보험</p>
            </div>
        </div>
        
        <div class="price-summary">
            <div class="price-row">
                <span>상품 가격</span>
                <span id="basePrice">₩ 120,000</span>
            </div>
            <div class="price-row">
                <span>인원 수</span>
                <span id="paxDisplay">1명</span>
            </div>
            <div class="price-row total">
                <span>총 결제 금액</span>
                <span id="totalPrice">₩ 120,000</span>
            </div>
        </div>
    </div>
    
    <!-- Customer Information -->
    <div class="customer-info">
        <h3>주문자 정보</h3>
        <form id="customerForm">
            <div class="form-row">
                <div class="form-group">
                    <label for="customerName">이름 *</label>
                    <input type="text" id="customerName" name="customerName" required>
                    <div class="error-message" id="nameError">이름을 입력해주세요.</div>
                </div>
                <div class="form-group">
                    <label for="customerPhone">연락처 *</label>
                    <input type="tel" id="customerPhone" name="customerPhone" placeholder="010-1234-5678" required>
                    <div class="error-message" id="phoneError">연락처를 입력해주세요.</div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="customerEmail">이메일 *</label>
                    <input type="email" id="customerEmail" name="customerEmail" required>
                    <div class="error-message" id="emailError">올바른 이메일을 입력해주세요.</div>
                </div>
                <div class="form-group">
                    <label for="emergencyContact">비상연락처</label>
                    <input type="tel" id="emergencyContact" name="emergencyContact" placeholder="010-1234-5678">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="pickupLocation">픽업 위치 *</label>
                    <select id="pickupLocation" name="pickupLocation" required>
                        <option value="">픽업 위치를 선택하세요</option>
                        <option value="nusadua">누사두아</option>
                        <option value="kuta">쿠타</option>
                        <option value="seminyak">세미냑</option>
                        <option value="sanur">사누르</option>
                        <option value="ubud">우붓</option>
                    </select>
                    <div class="error-message" id="locationError">픽업 위치를 선택해주세요.</div>
                </div>
                <div class="form-group">
                    <label for="hotelName">호텔명</label>
                    <input type="text" id="hotelName" name="hotelName" placeholder="숙박 중인 호텔명">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="specialRequests">특별 요청사항</label>
                    <input type="text" id="specialRequests" name="specialRequests" placeholder="알레르기, 식이제한 등">
                </div>
            </div>
        </form>
    </div>
    
    <!-- Payment Section -->
    <div class="payment-section">
        <h3>결제 수단</h3>
        <div class="payment-widget" id="payment-widget">
            <div style="text-align: center; padding: 40px; color: #666;">
                <div style="margin-bottom: 15px;">⏳</div>
                <p>결제위젯을 불러오는 중입니다...</p>
            </div>
        </div>
        <div class="loading" id="paymentLoading">
            <div class="loading-spinner"></div>
            <p>결제 처리 중입니다...</p>
        </div>
        <button type="button" class="payment-button" id="paymentButton">
            결제하기
        </button>
    </div>
</div>

<section class="section-footer">
	<div class="row">
		<div class="col-left">
			<p>Copyright &copy; 2025</p>
			<p>서울특별시 강남구 테헤란로 123 <br>
			전화 : 02-1234-5678 <br>
			이메일 : contact@trippage.co.kr </p>
			<a href="https://www.facebook.com/trippage" target="_blank"><span class="ion-social-facebook icon-social"></span></a>
			<a href="https://www.instagram.com/trippage" target="_blank"><span class="ion-social-instagram icon-social"></span></a>
			<a href="https://twitter.com/trippage" target="_blank"><span class="ion-social-twitter icon-social"></span></a>
		</div>
		<div class="col-right">
			<b>여행 경험</b>
			<ul>
				<li><a href="#">자연</a></li>
				<li><a href="#">문화</a></li>
				<li><a href="#">종교</a></li>
				<li><a href="#">요리</a></li>
				<li><a href="#">모험</a></li>
			</ul>
		</div>
		<div class="col-right">
			<b>여행 가이드</b>
			<ul>
				<li><a href="#">관광 가이드</a></li>
				<li><a href="#">여행사</a></li>
				<li><a href="#">숙박시설</a></li>
				<li><a href="#">저예산 여행</a></li>
			</ul>
		</div>
		<div class="col-right">
			<b>소식</b>
			<ul>
				<li><a href="#">뉴스</a></li>
				<li><a href="#">이벤트</a></li>
				<li><a href="#">팁 & 정보</a></li>
			</ul>
		</div>
	</div>
	<div class="footer-bottom">
		<p><a href="https://github.com/cscs0829/trippage-page" rel="noreferer" target="_blank">트립페이지</a> - <span class="ion-heart red"></span>으로 만든 사랑스러운 웹사이트</p>
		</div>
</section>

    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    
    <script>
        // URL 파라미터에서 주문 정보 가져오기
        const urlParams = new URLSearchParams(window.location.search);
        const travelDate = urlParams.get('date');
        const paxCount = urlParams.get('pax') || '1';
        const basePrice = 120000;
        const totalAmount = basePrice * parseInt(paxCount);
        
        // 주문 정보 표시
        if (travelDate) {
            document.getElementById('travelDate').textContent = `여행 날짜: ${travelDate}`;
        }
        document.getElementById('paxCount').textContent = `인원 수: ${paxCount}명`;
        document.getElementById('paxDisplay').textContent = `${paxCount}명`;
        document.getElementById('totalPrice').textContent = `₩ ${totalAmount.toLocaleString()}`;
        
        // 토스페이먼츠 초기화 (실제 사용시에는 본인의 클라이언트 키를 사용해야 합니다)
        const clientKey = 'test_ck_24DdEXpBdvOaEgdaYkD9GgKWv6qNn5vbKyU6bXy4oWb5JvGq4Ek3pYzV2RnQ'; // 테스트용 키
        
        // 결제위젯 초기화
        let paymentWidget;
        let tossPayments;
        
        // DOM이 로드된 후 결제위젯 초기화
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('DOM 로드 완료, 결제위젯 초기화 시작');
            console.log('결제 금액:', totalAmount);
            
            try {
                // TossPayments 객체 확인
                if (typeof TossPayments === 'undefined') {
                    throw new Error('TossPayments SDK가 로드되지 않았습니다.');
                }
                
                tossPayments = TossPayments(clientKey);
                console.log('TossPayments 객체 생성 완료:', tossPayments);
                
                paymentWidget = tossPayments.widgets({
                    customerKey: generateRandomString(), // 고객 고유 키
                });
                
                console.log('PaymentWidget 객체 생성 완료:', paymentWidget);
                
                // 결제 금액 설정
                await paymentWidget.setAmount({
                    currency: 'KRW',
                    value: totalAmount,
                });
                
                // 결제 UI 렌더링
                await paymentWidget.renderPaymentMethods({
                    selector: '#payment-widget',
                    variantKey: 'DEFAULT'
                });
                
                console.log('결제위젯이 성공적으로 초기화되었습니다.');
            } catch (error) {
                console.error('결제위젯 초기화 오류:', error);
                document.getElementById('payment-widget').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #dc3545;">
                        <div style="margin-bottom: 15px;">❌</div>
                        <p><strong>결제위젯을 불러오는 중 오류가 발생했습니다.</strong></p>
                        <p style="font-size: 14px; margin-top: 10px;">오류: ${error.message || '알 수 없는 오류'}</p>
                        <p style="font-size: 12px; color: #666; margin-top: 10px;">
                            실제 서비스에서는 토스페이먼츠 개발자센터에서 발급받은<br>
                            본인의 클라이언트 키를 사용해야 합니다.
                        </p>
                        <button onclick="location.reload()" style="margin-top: 15px; padding: 8px 16px; background: #f25601; color: white; border: none; border-radius: 4px; cursor: pointer;">페이지 새로고침</button>
                    </div>
                `;
            }
        });
        
        // 랜덤 문자열 생성 함수
        function generateRandomString() {
            return Math.random().toString(36).substring(2, 15);
        }
        
        // 주문 ID 생성 함수
        function generateOrderId() {
            const date = new Date();
            const dateString = date.getFullYear().toString() + 
                             (date.getMonth() + 1).toString().padStart(2, '0') + 
                             date.getDate().toString().padStart(2, '0');
            const timeString = date.getHours().toString().padStart(2, '0') + 
                             date.getMinutes().toString().padStart(2, '0') + 
                             date.getSeconds().toString().padStart(2, '0');
            const randomString = Math.random().toString(36).substring(2, 8);
            return `ORDER_${dateString}_${timeString}_${randomString}`;
        }
        
        // 폼 검증 함수
        function validateForm() {
            let isValid = true;
            
            // 이름 검증
            const name = document.getElementById('customerName').value.trim();
            if (!name) {
                document.getElementById('nameError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('nameError').style.display = 'none';
            }
            
            // 연락처 검증
            const phone = document.getElementById('customerPhone').value.trim();
            const phoneRegex = /^01[0-9]-?[0-9]{4}-?[0-9]{4}$/;
            if (!phone || !phoneRegex.test(phone.replace(/-/g, ''))) {
                document.getElementById('phoneError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('phoneError').style.display = 'none';
            }
            
            // 이메일 검증
            const email = document.getElementById('customerEmail').value.trim();
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!email || !emailRegex.test(email)) {
                document.getElementById('emailError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('emailError').style.display = 'none';
            }
            
            // 픽업 위치 검증
            const location = document.getElementById('pickupLocation').value;
            if (!location) {
                document.getElementById('locationError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('locationError').style.display = 'none';
            }
            
            return isValid;
        }
        
        // 결제하기 버튼 클릭 이벤트
        document.getElementById('paymentButton').addEventListener('click', async function() {
            // 결제위젯이 초기화되었는지 확인
            if (!paymentWidget) {
                alert('결제 시스템을 준비 중입니다. 잠시 후 다시 시도해주세요.');
                return;
            }
            
            // 폼 검증
            if (!validateForm()) {
                alert('필수 정보를 모두 입력해주세요.');
                return;
            }
            
            // 로딩 표시
            document.getElementById('paymentLoading').style.display = 'block';
            this.disabled = true;
            
            try {
                // 주문 정보 수집
                const orderData = {
                    orderId: generateOrderId(),
                    orderName: '코끼리 사파리 공원',
                    customerName: document.getElementById('customerName').value,
                    customerEmail: document.getElementById('customerEmail').value,
                    customerPhone: document.getElementById('customerPhone').value,
                    emergencyContact: document.getElementById('emergencyContact').value,
                    pickupLocation: document.getElementById('pickupLocation').value,
                    hotelName: document.getElementById('hotelName').value,
                    specialRequests: document.getElementById('specialRequests').value,
                    travelDate: travelDate,
                    paxCount: paxCount,
                    amount: totalAmount
                };
                
                console.log('결제 요청 데이터:', orderData);
                
                // 결제 요청
                await paymentWidget.requestPayment({
                    orderId: orderData.orderId,
                    orderName: orderData.orderName,
                    customerName: orderData.customerName,
                    customerEmail: orderData.customerEmail,
                    customerMobilePhone: orderData.customerPhone,
                    successUrl: `${window.location.origin}/trippage/success.html`,
                    failUrl: `${window.location.origin}/trippage/fail.html`,
                });
                
            } catch (error) {
                console.error('결제 오류:', error);
                alert(`결제 중 오류가 발생했습니다: ${error.message || '알 수 없는 오류'}`);
            } finally {
                // 로딩 숨기기
                document.getElementById('paymentLoading').style.display = 'none';
                this.disabled = false;
            }
        });
        
        // 전화번호 자동 하이픈 추가
        document.getElementById('customerPhone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^0-9]/g, '');
            if (value.length >= 3 && value.length <= 7) {
                value = value.replace(/(\d{3})(\d+)/, '$1-$2');
            } else if (value.length > 7) {
                value = value.replace(/(\d{3})(\d{4})(\d+)/, '$1-$2-$3');
            }
            e.target.value = value;
        });
        
        document.getElementById('emergencyContact').addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^0-9]/g, '');
            if (value.length >= 3 && value.length <= 7) {
                value = value.replace(/(\d{3})(\d+)/, '$1-$2');
            } else if (value.length > 7) {
                value = value.replace(/(\d{3})(\d{4})(\d+)/, '$1-$2-$3');
            }
            e.target.value = value;
        });
    </script>
</body>
</html>
